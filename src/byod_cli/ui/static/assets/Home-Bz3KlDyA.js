import{r as y,j as i,m as n,L as o,s as v,a as l}from"./index-eBHcrhee.js";import{u as g}from"./useApi-DI9ecT4O.js";import{S as b}from"./StatusBadge-CD4kIfB2.js";function k(){const{data:e,loading:t}=g("/status"),{data:a,loading:h,error:s}=g("/jobs?limit=5"),[d,j]=y.useState(null);y.useEffect(()=>{fetch("/api/status/aws").then(r=>r.json()).then(r=>j(r.configured)).catch(()=>j(!1))},[]);const c=(a||[]).reduce((r,f)=>{r.total++;const m=f.status.toLowerCase();return m==="completed"?r.completed++:m==="processing"?r.processing++:m==="failed"&&r.failed++,r},{total:0,completed:0,processing:0,failed:0}),x=(e==null?void 0:e.tenant_valid)??!1,p=x&&d&&(e==null?void 0:e.kms_key_configured);return i.jsxs("div",{children:[i.jsxs("div",{className:"page-header",children:[i.jsx("h1",{children:"Welcome to BYOD"}),i.jsx("p",{children:"Secure biotech data processing with zero-knowledge encryption"})]}),!t&&(e==null?void 0:e.tenant_error)&&i.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{background:"rgba(239, 68, 68, 0.08)",border:"1px solid rgba(239, 68, 68, 0.25)",borderRadius:"12px",padding:"20px 24px",marginBottom:"24px"},children:i.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--red)",strokeWidth:"2",style:{flexShrink:0,marginTop:"2px"},children:[i.jsx("circle",{cx:"12",cy:"12",r:"10"}),i.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),i.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:600,marginBottom:"4px",color:"var(--red)"},children:"Tenant issue detected"}),i.jsx("div",{style:{color:"var(--text-dim)",fontSize:"14px",marginBottom:"12px"},children:e.tenant_error}),i.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[e.tenant_error.includes("API key")&&i.jsx("div",{className:"cli-hint",style:{display:"inline-block"},children:"byod auth login"}),e.tenant_error.includes("tenant")&&i.jsx("a",{href:e.api_url,target:"_blank",rel:"noopener noreferrer",className:"btn-small",children:"Open Dashboard"}),i.jsx(o,{to:"/setup",className:"btn-small",children:"Re-run Setup"})]})]})]})}),!t&&!(e!=null&&e.tenant_error)&&(!(e!=null&&e.authenticated)||d===!1)&&i.jsxs(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{background:"rgba(234, 179, 8, 0.08)",border:"1px solid rgba(234, 179, 8, 0.2)",borderRadius:"12px",padding:"20px 24px",marginBottom:"24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:600,marginBottom:"4px"},children:"Setup required"}),i.jsx("div",{style:{color:"var(--text-dim)",fontSize:"14px"},children:e!=null&&e.authenticated?"AWS credentials not detected. Configure your ~/.aws/credentials.":"Run 'byod auth login' in your terminal to authenticate, then refresh."})]}),i.jsx(o,{to:"/setup",className:"btn-primary",style:{flexShrink:0},children:"Run Setup"})]}),!t&&x&&(!(e!=null&&e.kms_key_configured)||!(e!=null&&e.role_configured))&&i.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{background:e!=null&&e.kms_key_error||e!=null&&e.role_error?"rgba(239, 68, 68, 0.08)":"rgba(234, 179, 8, 0.08)",border:`1px solid ${e!=null&&e.kms_key_error||e!=null&&e.role_error?"rgba(239, 68, 68, 0.25)":"rgba(234, 179, 8, 0.2)"}`,borderRadius:"12px",padding:"20px 24px",marginBottom:"24px"},children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[i.jsxs("div",{children:[i.jsx("div",{style:{fontWeight:600,marginBottom:"4px"},children:e!=null&&e.kms_key_error||e!=null&&e.role_error?"AWS resources missing":"KMS setup incomplete"}),i.jsx("div",{style:{color:"var(--text-dim)",fontSize:"14px"},children:e!=null&&e.kms_key_error&&(e!=null&&e.role_error)?"KMS key and IAM role no longer exist in AWS. Re-run setup to recreate them.":e!=null&&e.kms_key_error?e.kms_key_error:e!=null&&e.role_error?e.role_error:!(e!=null&&e.kms_key_configured)&&!(e!=null&&e.role_configured)?"KMS key and IAM role are not configured. Run setup to create them.":e!=null&&e.kms_key_configured?"IAM role is not configured.":"KMS key is not configured."})]}),i.jsx(o,{to:"/setup",className:"btn-primary",style:{flexShrink:0},children:e!=null&&e.kms_key_error||e!=null&&e.role_error?"Re-run Setup":"Run Setup"})]})}),i.jsxs(n.div,{className:"stats-row",variants:v,initial:"initial",animate:"animate",children:[i.jsxs(n.div,{className:"stat-card",variants:l,children:[i.jsx("div",{className:"label",children:"Authentication"}),i.jsx("div",{className:"value",style:{fontSize:"18px"},children:t?i.jsx("span",{className:"loading-spinner"}):e!=null&&e.authenticated?i.jsx("span",{style:{color:"var(--green)"},children:"Connected"}):i.jsx("span",{style:{color:"var(--red)"},children:"Not authenticated"})}),(e==null?void 0:e.profile)&&i.jsxs("div",{style:{fontSize:"12px",color:"var(--text-dim)",marginTop:"4px"},children:["Profile: ",e.profile]})]}),i.jsxs(n.div,{className:"stat-card",variants:l,children:[i.jsx("div",{className:"label",children:"Tenant"}),i.jsx("div",{className:"value",style:{fontSize:"18px"},children:t?i.jsx("span",{className:"loading-spinner"}):x?i.jsx("span",{style:{color:"var(--green)"},children:"Active"}):e!=null&&e.authenticated?i.jsx("span",{style:{color:"var(--red)"},children:"Invalid"}):i.jsx("span",{style:{color:"var(--text-dim)"},children:"—"})}),(e==null?void 0:e.tenant_id)&&i.jsxs("div",{style:{fontSize:"12px",color:"var(--text-dim)",marginTop:"4px",fontFamily:"monospace"},children:[e.tenant_id.slice(0,12),"..."]})]}),i.jsxs(n.div,{className:"stat-card",variants:l,children:[i.jsx("div",{className:"label",children:"AWS Credentials"}),i.jsx("div",{className:"value",style:{fontSize:"18px"},children:d===null?i.jsx("span",{className:"loading-spinner"}):d?i.jsx("span",{style:{color:"var(--green)"},children:"Configured"}):i.jsx("span",{style:{color:"var(--yellow)"},children:"Not found"})})]}),i.jsxs(n.div,{className:"stat-card",variants:l,children:[i.jsx("div",{className:"label",children:"CLI Version"}),i.jsx("div",{className:"value",style:{fontSize:"18px"},children:(e==null?void 0:e.version)||i.jsx("span",{className:"loading-spinner"})}),(e==null?void 0:e.api_url)&&i.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",marginTop:"4px"},children:e.api_url})]})]}),i.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"32px"},children:[i.jsx(o,{to:"/submit",className:"btn-primary",style:{textDecoration:"none",opacity:p?1:.5,pointerEvents:p?"auto":"none"},children:"Submit New Job"}),i.jsx(o,{to:"/jobs",className:"btn-secondary",style:{textDecoration:"none"},children:"View All Jobs"})]}),!h&&!s&&a&&a.length>0&&i.jsxs(n.div,{className:"stats-row",variants:v,initial:"initial",animate:"animate",style:{marginBottom:"24px"},children:[i.jsxs(n.div,{className:"stat-card",variants:l,children:[i.jsx("div",{className:"label",children:"Total Jobs"}),i.jsx("div",{className:"value",children:c.total})]}),i.jsxs(n.div,{className:"stat-card",variants:l,children:[i.jsx("div",{className:"label",children:"Completed"}),i.jsx("div",{className:"value",style:{color:"var(--green)"},children:c.completed})]}),i.jsxs(n.div,{className:"stat-card",variants:l,children:[i.jsx("div",{className:"label",children:"Processing"}),i.jsx("div",{className:"value",style:{color:"var(--yellow)"},children:c.processing})]}),i.jsxs(n.div,{className:"stat-card",variants:l,children:[i.jsx("div",{className:"label",children:"Failed"}),i.jsx("div",{className:"value",style:{color:"var(--red)"},children:c.failed})]})]}),i.jsxs("div",{className:"card",style:{padding:0},children:[i.jsx("div",{style:{padding:"20px 24px",borderBottom:"1px solid var(--border)"},children:i.jsx("h2",{style:{fontSize:"18px",fontWeight:600},children:"Recent Jobs"})}),h?i.jsx("div",{className:"loading",children:"Loading jobs..."}):s?i.jsxs("div",{style:{padding:"32px 24px",textAlign:"center",color:"var(--text-dim)"},children:[i.jsx("p",{style:{marginBottom:"8px"},children:"Could not load jobs"}),i.jsx("p",{style:{fontSize:"13px"},children:s.includes("401")||s.includes("authenticated")?"Authentication required — run 'byod auth login' first.":s.includes("502")||s.includes("connect")?"API server is unreachable. Check your connection.":s})]}):!a||a.length===0?i.jsxs("div",{style:{padding:"48px 24px",textAlign:"center",color:"var(--text-dim)"},children:[i.jsx("p",{style:{marginBottom:"12px"},children:"No jobs yet"}),p&&i.jsx(o,{to:"/submit",className:"btn-primary",style:{textDecoration:"none"},children:"Submit your first job"})]}):i.jsx("div",{className:"table-container",children:i.jsxs("table",{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Job ID"}),i.jsx("th",{children:"Pipeline"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Submitted"})]})}),i.jsx("tbody",{children:a.map(r=>i.jsxs("tr",{onClick:()=>window.location.href=`/jobs/${r.job_id}`,children:[i.jsxs("td",{style:{fontFamily:"monospace",fontSize:"13px"},children:[r.job_id.slice(0,8),"..."]}),i.jsx("td",{children:r.plugin_name}),i.jsx("td",{children:i.jsx(b,{status:r.status})}),i.jsx("td",{style:{color:"var(--text-dim)"},children:new Date(r.created_at).toLocaleString()})]},r.job_id))})]})})]})]})}export{k as Home};
