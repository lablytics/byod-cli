import{r as d,j as r,m as l,b as _,c as x,d as b,L as v,h as w}from"./index-B8SBTCI8.js";import{a as j,b as A}from"./Skeleton-Cg_dwXAZ.js";import{u as N,P as W}from"./ProgressTracker-4PGVOIMw.js";function B(){const[e,i]=d.useState(null),[a,h]=d.useState(!0),[o,u]=d.useState("us-east-1"),[c,m]=d.useState(!1),n=N();d.useEffect(()=>{j("/setup/status").then(i).catch(()=>{}).finally(()=>h(!1))},[]);const S=()=>{n.start("/api/setup/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({region:o,force_new:c})})},g=(e==null?void 0:e.authenticated)&&(e==null?void 0:e.aws_configured)&&(e==null?void 0:e.tenant_valid)&&(e==null?void 0:e.kms_key_configured)&&(e==null?void 0:e.registered),k=(e==null?void 0:e.authenticated)&&(e==null?void 0:e.aws_configured)&&(e==null?void 0:e.tenant_valid);if(n.result){const t=n.result;return r.jsxs(l.div,{className:"success-content",variants:_,initial:"initial",animate:"animate",children:[r.jsxs(l.div,{className:"success-icon confetti-container",variants:x,children:[r.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"var(--green)",strokeWidth:"2",children:[r.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),r.jsx(l.path,{d:"M9 12l2 2 4-4",variants:b,initial:"initial",animate:"animate"})]}),[{color:"var(--green)",target:"translate(-30px, -30px) scale(1)"},{color:"var(--accent)",target:"translate(30px, -25px) scale(1)"},{color:"var(--yellow)",target:"translate(-25px, 30px) scale(1)"},{color:"var(--blue)",target:"translate(35px, 20px) scale(1)"},{color:"var(--green)",target:"translate(0px, -35px) scale(1)"},{color:"var(--accent)",target:"translate(-35px, 5px) scale(1)"}].map((s,y)=>r.jsx("span",{className:"confetti-particle",style:{background:s.color,top:"50%",left:"50%",animationDelay:`${y*.08}s`,"--confetti-target":s.target}},y))]}),r.jsx(l.h2,{variants:x,children:"Setup Complete!"}),r.jsx(l.p,{variants:x,style:{color:"var(--text-dim)",marginBottom:"16px"},children:"Your KMS key and IAM role have been configured with attestation enforcement."}),r.jsxs(l.div,{variants:x,className:"review-card",style:{textAlign:"left",maxWidth:"600px",margin:"0 auto"},children:[r.jsxs("div",{className:"review-section",children:[r.jsx("h4",{children:"KMS Key ARN"}),r.jsx("p",{style:{fontFamily:"monospace",fontSize:"12px",wordBreak:"break-all"},children:t.kms_key_arn})]}),r.jsxs("div",{className:"review-section",children:[r.jsx("h4",{children:"IAM Role ARN"}),r.jsx("p",{style:{fontFamily:"monospace",fontSize:"12px",wordBreak:"break-all"},children:t.role_arn})]}),r.jsxs("div",{className:"review-section",children:[r.jsx("h4",{children:"Region"}),r.jsx("p",{children:t.region})]}),r.jsxs("div",{className:"review-section",children:[r.jsx("h4",{children:"Security Guarantees"}),r.jsxs("ul",{style:{fontSize:"13px",color:"var(--text-dim)",paddingLeft:"18px",margin:"4px 0 0 0"},children:[r.jsx("li",{children:"Only you can manage/delete the KMS key"}),r.jsx("li",{children:"Only the Nitro Enclave (with PCR0 verification) can decrypt"}),r.jsx("li",{children:"Lablytics operators cannot access your data"})]})]})]}),r.jsxs(l.div,{className:"success-actions",variants:x,children:[r.jsx(v,{to:"/",className:"btn-primary",style:{textDecoration:"none"},children:"Go to Home"}),r.jsx(v,{to:"/submit",className:"btn-secondary",style:{textDecoration:"none"},children:"Submit a Job"})]})]})}return r.jsxs(l.div,{variants:w,initial:"initial",animate:"animate",children:[r.jsxs("div",{className:"page-header",children:[r.jsx("h1",{children:"Setup Wizard"}),r.jsx("p",{children:"Configure your AWS KMS key and IAM role for secure data processing"})]}),a?r.jsx(A,{items:5}):r.jsxs(r.Fragment,{children:[(e==null?void 0:e.tenant_error)&&r.jsx(l.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{background:"rgba(239, 68, 68, 0.08)",border:"1px solid rgba(239, 68, 68, 0.25)",borderRadius:"12px",padding:"20px 24px",marginBottom:"24px"},children:r.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[r.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--red)",strokeWidth:"2",style:{flexShrink:0,marginTop:"2px"},children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),r.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:600,marginBottom:"4px",color:"var(--red)"},children:"Tenant issue detected"}),r.jsx("div",{style:{color:"var(--text-dim)",fontSize:"14px",marginBottom:"12px"},children:e.tenant_error}),r.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[e.tenant_error.includes("API key")&&r.jsx("div",{className:"cli-hint",style:{display:"inline-block"},children:"byod auth login"}),e.tenant_error.includes("tenant")&&r.jsx("a",{href:"/api/status",onClick:t=>{t.preventDefault(),j("/status").then(s=>{s.api_url&&window.open(s.api_url,"_blank")})},className:"btn-small",children:"Open Dashboard"})]})]})]})}),r.jsxs("div",{className:"card",style:{marginBottom:"24px"},children:[r.jsx("h3",{style:{fontSize:"16px",marginBottom:"16px"},children:"Prerequisites"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[r.jsx(p,{label:"API Authentication",ok:e==null?void 0:e.authenticated,hint:"Run 'byod auth login' in your terminal"}),r.jsx(p,{label:"AWS Credentials",ok:e==null?void 0:e.aws_configured,hint:"Configure ~/.aws/credentials or set AWS_ACCESS_KEY_ID",detail:e!=null&&e.aws_account_id?`Account: ${e.aws_account_id}`:void 0}),r.jsx(p,{label:"Tenant Account",ok:e==null?void 0:e.tenant_valid,pending:(e==null?void 0:e.authenticated)&&!(e!=null&&e.tenant_valid)&&!(e!=null&&e.tenant_error),hint:e!=null&&e.tenant_error?e.tenant_error:e!=null&&e.authenticated?"Tenant must exist and be active":"Authenticate first to check tenant status",detail:e!=null&&e.tenant_id?`ID: ${e.tenant_id.slice(0,16)}...`:void 0}),r.jsx(p,{label:"KMS Key",ok:e==null?void 0:e.kms_key_configured,pending:!(e!=null&&e.kms_key_configured)&&(e==null?void 0:e.tenant_valid)&&!(e!=null&&e.kms_key_error),hint:e!=null&&e.kms_key_error?e.kms_key_error:e!=null&&e.kms_key_configured?"":"Will be created during setup",detail:e!=null&&e.kms_key_arn?f(e.kms_key_arn):void 0}),r.jsx(p,{label:"IAM Role",ok:e==null?void 0:e.role_configured,pending:!(e!=null&&e.role_configured)&&(e==null?void 0:e.tenant_valid)&&!(e!=null&&e.role_error),hint:e!=null&&e.role_error?e.role_error:e!=null&&e.role_configured?"":"Will be created during setup",detail:e!=null&&e.role_arn?f(e.role_arn):void 0})]})]}),g?r.jsxs("div",{className:"card",style:{marginBottom:"24px"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"},children:[r.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"var(--green)",strokeWidth:"2",children:[r.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),r.jsx("path",{d:"M9 12l2 2 4-4"})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:600,color:"var(--green)"},children:"Setup is complete!"}),r.jsx("div",{style:{color:"var(--text-dim)",fontSize:"13px"},children:"Your KMS key and IAM role are configured. You can submit jobs."})]})]}),r.jsxs("div",{style:{borderTop:"1px solid var(--border)",paddingTop:"16px"},children:[r.jsx("p",{style:{color:"var(--text-dim)",fontSize:"13px",marginBottom:"12px"},children:"If you've destroyed and recreated your AWS resources, you can re-run setup to create new ones."}),r.jsx("button",{className:"btn-secondary",onClick:()=>m(!0),style:{fontSize:"13px"},children:"Re-run Setup with New Resources"})]})]}):null,k&&(!g||c)&&r.jsxs("div",{className:"card",style:{marginBottom:"24px"},children:[r.jsx("h3",{style:{fontSize:"16px",marginBottom:"16px"},children:"Configuration"}),r.jsxs("div",{className:"input-group",children:[r.jsx("label",{children:"AWS Region"}),r.jsxs("select",{className:"text-input",value:o,onChange:t=>u(t.target.value),style:{maxWidth:"300px"},children:[r.jsx("option",{value:"us-east-1",children:"US East (N. Virginia)"}),r.jsx("option",{value:"us-east-2",children:"US East (Ohio)"}),r.jsx("option",{value:"us-west-1",children:"US West (N. California)"}),r.jsx("option",{value:"us-west-2",children:"US West (Oregon)"}),r.jsx("option",{value:"eu-west-1",children:"EU (Ireland)"}),r.jsx("option",{value:"eu-central-1",children:"EU (Frankfurt)"})]}),r.jsx("div",{className:"input-hint",children:"The AWS region where your KMS key will be created"})]}),((e==null?void 0:e.kms_key_configured)||(e==null?void 0:e.role_configured))&&r.jsx("div",{style:{marginTop:"16px",marginBottom:"16px"},children:r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer",fontSize:"14px"},children:[r.jsx("input",{type:"checkbox",checked:c,onChange:t=>m(t.target.checked),style:{width:"16px",height:"16px",accentColor:"var(--accent)"}}),r.jsxs("span",{children:["Replace existing resources",r.jsx("span",{style:{color:"var(--text-dim)",fontSize:"12px",display:"block"},children:"Delete current KMS key and IAM role, then create new ones. Use this if your AWS resources were destroyed."})]})]})}),c&&r.jsx("div",{style:{background:"rgba(234, 179, 8, 0.08)",border:"1px solid rgba(234, 179, 8, 0.2)",borderRadius:"8px",padding:"12px 16px",marginBottom:"16px",fontSize:"13px",color:"var(--yellow)"},children:"Existing KMS key will be scheduled for deletion (7-day waiting period). A new key and IAM role will be created and registered."}),r.jsx("button",{className:"btn-primary",onClick:S,disabled:n.active,children:n.active?"Running...":c?"Replace & Re-run Setup":"Run Setup"})]}),(n.active||n.error)&&r.jsx(W,{progress:n.progress,error:n.error,label:"Setup Progress"}),!(e!=null&&e.authenticated)&&r.jsxs("div",{className:"card",style:{marginBottom:"24px",textAlign:"center"},children:[r.jsx("p",{style:{color:"var(--text-dim)",marginBottom:"12px"},children:"Authenticate first to get started"}),r.jsx("div",{className:"cli-hint",style:{display:"inline-block"},children:"byod auth login"})]}),(e==null?void 0:e.authenticated)&&!(e!=null&&e.aws_configured)&&r.jsxs("div",{className:"card",style:{marginBottom:"24px",textAlign:"center"},children:[r.jsx("p",{style:{color:"var(--text-dim)",marginBottom:"12px"},children:"AWS credentials are needed to create your KMS key and IAM role"}),r.jsx("div",{className:"cli-hint",style:{display:"inline-block"},children:"aws configure"}),r.jsx("div",{style:{color:"var(--text-dim)",fontSize:"12px",marginTop:"8px"},children:"Or set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables"})]})]})]})}function p({label:e,ok:i,pending:a,hint:h,detail:o}){return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[r.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:i?"rgba(34, 197, 94, 0.15)":a?"rgba(234, 179, 8, 0.15)":"rgba(239, 68, 68, 0.15)",color:i?"var(--green)":a?"var(--yellow)":"var(--red)",fontSize:"14px",flexShrink:0},children:i?"✓":a?"•":"✗"}),r.jsxs("div",{style:{minWidth:0},children:[r.jsx("div",{style:{fontWeight:500},children:e}),!i&&h&&r.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)"},children:h}),o&&r.jsx("div",{style:{fontSize:"11px",color:"var(--text-dim)",fontFamily:"monospace",marginTop:"2px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o})]})]})}function f(e){const i=e.split(":");return i.length>=6?`${i.slice(-1)[0].slice(0,32)}...`:e.slice(0,40)+"..."}export{B as SetupWizard};
