import{r as c,j as t}from"./index-B8SBTCI8.js";function C(){const[e,s]=c.useState({active:!1,progress:null,result:null,error:null}),r=c.useRef(null),i=c.useCallback(async(l,p)=>{var o;s({active:!0,progress:null,result:null,error:null});try{const n=await fetch(l,p);if(!n.ok){const d=await n.json().catch(()=>({detail:n.statusText}));s(v=>({...v,active:!1,error:d.detail||`HTTP ${n.status}`}));return}const u=(o=n.body)==null?void 0:o.getReader();if(!u){s(d=>({...d,active:!1,error:"No response body"}));return}r.current=u;const m=new TextDecoder;let x="";for(;;){const{done:d,value:v}=await u.read();if(d)break;x+=m.decode(v,{stream:!0});const S=x.split(`
`);x=S.pop()||"";let f="";for(const g of S)if(g.startsWith("event: "))f=g.slice(7).trim();else if(g.startsWith("data: ")){const h=JSON.parse(g.slice(6));f==="progress"?s(j=>({...j,progress:h})):f==="complete"?s({active:!1,progress:null,result:h,error:null}):f==="error"&&s(j=>({...j,active:!1,error:h.message}))}}}catch(n){s(u=>({...u,active:!1,error:n instanceof Error?n.message:"Connection failed"}))}},[]),a=c.useCallback(()=>{r.current&&(r.current.cancel(),r.current=null),s({active:!1,progress:null,result:null,error:null})},[]);return{...e,start:i,reset:a}}const w=["receiving","packaging","encrypting","uploading_data","uploading_key","submitting"],y=["checking","downloading","unwrapping","decrypting","extracting"];function E(e){return e!=null&&e.toLowerCase().includes("retriev")?y:w}function T(e){return e.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}function N(){const e=c.useRef(Date.now()),[s,r]=c.useState(0);c.useEffect(()=>{const l=setInterval(()=>{r(Math.floor((Date.now()-e.current)/1e3))},1e3);return()=>clearInterval(l)},[]);const i=Math.floor(s/60),a=s%60;return t.jsx("span",{children:i>0?`${i}m ${a}s`:`${a}s`})}function R({progress:e,error:s,label:r,stages:i}){if(s)return t.jsx("div",{className:"error-message",children:s});if(!e)return null;const a=i||E(r),l=a.indexOf(e.stage);return t.jsxs("div",{className:"submission-progress",children:[r&&t.jsxs("div",{style:{fontSize:"12px",color:"var(--text-dim)",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{children:r}),t.jsx(N,{})]}),t.jsx("div",{className:"progress-stages",children:a.map((p,o)=>{const m=o<l?"completed":o===l?"active":"";return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center"},children:[o>0&&t.jsx("span",{className:"progress-stage-arrow","aria-hidden":"true",children:"â€º"}),t.jsxs("span",{className:`progress-stage ${m}`,children:[t.jsx("span",{className:"progress-stage-dot"}),T(p)]})]},p)})}),t.jsx("div",{className:"progress-message",children:e.message}),t.jsx("div",{className:"progress-bar",children:t.jsx("div",{className:`progress-fill ${e.percent<100?"glowing":""}`,style:{width:`${e.percent}%`}})}),t.jsxs("div",{style:{fontSize:"12px",color:"var(--text-dim)",marginTop:"6px",textAlign:"right"},children:[e.percent,"%"]})]})}export{R as P,C as u};
