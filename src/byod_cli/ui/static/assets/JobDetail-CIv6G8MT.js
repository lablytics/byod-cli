import{g as R,r as a,j as e,m as D,h as L,L as $}from"./index-DlxGab-w.js";import{a as B,c as j,d as v}from"./Skeleton-CeN7a-3a.js";import{S as E}from"./StatusBadge-CWIYn1ry.js";import{u as J,P as H}from"./ProgressTracker-p4Qyc5Kl.js";function z(s){return s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`}function M(s){return s.startsWith("text/html")?"HTML":s==="application/json"?"JSON":s.startsWith("text/")?"TXT":s.startsWith("image/")?"IMG":"BIN"}function G(){const{jobId:s}=R(),[n,k]=a.useState(null),[C,T]=a.useState(!0),[y,I]=a.useState(null),o=J(),[l,N]=a.useState(null),[t,b]=a.useState(null),[S,c]=a.useState(null),[m,w]=a.useState(!1);a.useEffect(()=>{if(!s)return;const i=()=>{B(`/jobs/${s}`).then(k).catch(u=>I(u.message)).finally(()=>T(!1))};i();const r=setInterval(i,5e3);return()=>clearInterval(r)},[s]);const x=a.useCallback(()=>{s&&B(`/jobs/${s}/results`).then(i=>{N(i);const r=i.files.find(u=>u.mime.startsWith("text/html"));r&&b(r)}).catch(()=>{})},[s]);a.useEffect(()=>{x()},[x]),a.useEffect(()=>{o.result&&x()},[o.result,x]),a.useEffect(()=>{if(!t||!s){c(null);return}const i=t.mime.startsWith("text/")||t.mime==="application/json";if(t.mime.startsWith("text/html")){c(null);return}if(!i){c(null);return}w(!0),fetch(`/api/jobs/${s}/results/file?path=${encodeURIComponent(t.path)}`).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.text()}).then(c).catch(()=>c("Failed to load file content.")).finally(()=>w(!1))},[t,s]);const W=()=>{s&&o.start(`/api/jobs/${s}/get`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})};if(C)return e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx(j,{width:100,height:14})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:32},children:[e.jsx(j,{width:200,height:28}),e.jsx(j,{width:80,height:24,style:{borderRadius:12}})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:24},children:[e.jsx(v,{lines:2}),e.jsx(v,{lines:2})]}),e.jsx(v,{lines:4})]});if(y)return e.jsx("div",{className:"error-message",children:y});if(!n)return e.jsx("div",{className:"error-message",children:"Job not found"});const p=t==null?void 0:t.mime.startsWith("text/html"),f=t&&!p&&(t.mime.startsWith("text/")||t.mime==="application/json"),g=t==null?void 0:t.mime.startsWith("image/"),d=t&&s?`/api/jobs/${s}/results/file?path=${encodeURIComponent(t.path)}`:null,h=d?`${d}&download=true`:null;return e.jsxs(D.div,{variants:L,initial:"initial",animate:"animate",children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx($,{to:"/jobs",style:{fontSize:"14px",color:"var(--text-dim)"},children:"â† Back to Jobs"})}),e.jsxs("div",{className:"page-header",style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"12px"},children:["Job Details",e.jsx(E,{status:n.status})]}),e.jsx("p",{style:{fontFamily:"monospace",fontSize:"13px"},children:n.job_id})]}),n.status.toLowerCase()==="completed"&&e.jsx("button",{className:"btn-primary",onClick:W,disabled:o.active,children:o.active?"Downloading...":l?"Re-download Results":"Get Results"})]}),(o.active||o.error)&&e.jsx(H,{progress:o.progress,error:o.error,label:"Retrieving Results"}),l&&l.files.length>0&&e.jsxs("div",{className:"card",style:{marginBottom:"24px",padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"4px"},children:"Decrypted Results"}),e.jsxs("div",{style:{fontSize:"13px",color:"var(--text-dim)"},children:[l.files.length," file",l.files.length!==1?"s":""]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"var(--green)"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("path",{d:"M9 12l2 2 4-4"})]}),"Decrypted locally"]})]}),e.jsxs("div",{style:{display:"flex",minHeight:"400px"},children:[e.jsx("div",{style:{width:"260px",flexShrink:0,borderRight:"1px solid var(--border)",overflowY:"auto",maxHeight:"600px"},children:l.files.map(i=>e.jsxs("button",{onClick:()=>b(i),style:{display:"flex",alignItems:"center",gap:"10px",width:"100%",padding:"10px 16px",border:"none",borderBottom:"1px solid var(--border)",background:(t==null?void 0:t.path)===i.path?"rgba(99, 102, 241, 0.1)":"transparent",cursor:"pointer",textAlign:"left",color:"var(--text)",transition:"background 0.15s"},onMouseEnter:r=>{(t==null?void 0:t.path)!==i.path&&(r.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:r=>{(t==null?void 0:t.path)!==i.path&&(r.currentTarget.style.background="transparent")},children:[e.jsx("span",{style:{fontSize:"10px",fontWeight:700,padding:"2px 6px",borderRadius:"4px",background:i.mime.startsWith("text/html")?"rgba(99, 102, 241, 0.15)":i.mime==="application/json"?"rgba(234, 179, 8, 0.15)":"rgba(255,255,255,0.06)",color:i.mime.startsWith("text/html")?"var(--accent)":i.mime==="application/json"?"var(--yellow)":"var(--text-dim)",flexShrink:0},children:M(i.mime)}),e.jsxs("div",{style:{minWidth:0,flex:1},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:(t==null?void 0:t.path)===i.path?600:400,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.name}),i.path!==i.name&&e.jsx("div",{style:{fontSize:"11px",color:"var(--text-dim)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.path}),e.jsx("div",{style:{fontSize:"11px",color:"var(--text-dim)"},children:z(i.size)})]})]},i.path))}),e.jsxs("div",{style:{flex:1,overflow:"hidden",position:"relative"},children:[!t&&e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-dim)",fontSize:"14px"},children:"Select a file to view"}),t&&m&&e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-dim)"},children:"Loading..."}),t&&p&&d&&e.jsx("iframe",{src:d,title:t.name,style:{width:"100%",height:"100%",border:"none",background:"#fff"}}),t&&f&&S!==null&&!m&&e.jsx("pre",{style:{margin:0,padding:"16px",fontSize:"12px",fontFamily:"'Cascadia Code', 'Fira Code', 'JetBrains Mono', monospace",lineHeight:1.6,overflowY:"auto",maxHeight:"600px",whiteSpace:"pre-wrap",wordBreak:"break-word",color:"var(--text)"},children:S}),t&&g&&d&&e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",padding:"16px"},children:e.jsx("img",{src:d,alt:t.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}),t&&!p&&!f&&!g&&!m&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:"12px",color:"var(--text-dim)"},children:[e.jsxs("div",{style:{fontSize:"14px"},children:["Binary file (",z(t.size),")"]}),h&&e.jsxs("a",{href:h,download:t.name,className:"btn-secondary",style:{textDecoration:"none"},children:["Download ",t.name]})]}),t&&h&&(p||f||g)&&e.jsx("div",{style:{position:"absolute",bottom:0,right:0,padding:"8px 12px",background:"var(--surface)",borderTop:"1px solid var(--border)",borderLeft:"1px solid var(--border)",borderRadius:"8px 0 0 0"},children:e.jsx("a",{href:h,download:t.name,style:{fontSize:"12px",color:"var(--accent)",textDecoration:"none"},children:"Download"})})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"8px"},children:"Pipeline"}),e.jsx("div",{style:{fontSize:"16px",fontWeight:600},children:n.plugin_name})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"8px"},children:"Submitted"}),e.jsx("div",{style:{fontSize:"16px"},children:new Date(n.created_at).toLocaleString()})]})]}),n.description&&e.jsxs("div",{className:"card",style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"8px"},children:"Description"}),e.jsx("div",{children:n.description})]}),n.timeline&&n.timeline.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"16px"},children:"Timeline"}),e.jsx("div",{className:"timeline",children:n.timeline.map((i,r)=>e.jsxs("div",{className:"timeline-item",children:[e.jsx("div",{className:"phase",children:i.phase}),e.jsx("div",{className:"time",children:new Date(i.timestamp).toLocaleString()})]},r))})]}),e.jsx("div",{style:{marginTop:"24px"},children:e.jsxs("div",{className:"cli-hint",children:["byod status ",n.job_id]})})]})}export{G as JobDetail};
