import{d as N,r as a,j as e,m as W,f as R,L as D}from"./index-eBHcrhee.js";import{a as S}from"./useApi-DI9ecT4O.js";import{S as L}from"./StatusBadge-CD4kIfB2.js";import{u as $,P as E}from"./ProgressTracker-CtiyfszE.js";function w(s){return s<1024?`${s} B`:s<1024*1024?`${(s/1024).toFixed(1)} KB`:`${(s/(1024*1024)).toFixed(1)} MB`}function J(s){return s.startsWith("text/html")?"HTML":s==="application/json"?"JSON":s.startsWith("text/")?"TXT":s.startsWith("image/")?"IMG":"BIN"}function U(){const{jobId:s}=N(),[n,z]=a.useState(null),[B,T]=a.useState(!0),[v,k]=a.useState(null),o=$(),[l,C]=a.useState(null),[t,j]=a.useState(null),[y,c]=a.useState(null),[h,b]=a.useState(!1);a.useEffect(()=>{if(!s)return;const i=()=>{S(`/jobs/${s}`).then(z).catch(g=>k(g.message)).finally(()=>T(!1))};i();const r=setInterval(i,5e3);return()=>clearInterval(r)},[s]);const x=a.useCallback(()=>{s&&S(`/jobs/${s}/results`).then(i=>{C(i);const r=i.files.find(g=>g.mime.startsWith("text/html"));r&&j(r)}).catch(()=>{})},[s]);a.useEffect(()=>{x()},[x]),a.useEffect(()=>{o.result&&x()},[o.result,x]),a.useEffect(()=>{if(!t||!s){c(null);return}const i=t.mime.startsWith("text/")||t.mime==="application/json";if(t.mime.startsWith("text/html")){c(null);return}if(!i){c(null);return}b(!0),fetch(`/api/jobs/${s}/results/file?path=${encodeURIComponent(t.path)}`).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.text()}).then(c).catch(()=>c("Failed to load file content.")).finally(()=>b(!1))},[t,s]);const I=()=>{s&&o.start(`/api/jobs/${s}/get`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})};if(B)return e.jsx("div",{className:"loading",children:"Loading job details..."});if(v)return e.jsx("div",{className:"error-message",children:v});if(!n)return e.jsx("div",{className:"error-message",children:"Job not found"});const p=t==null?void 0:t.mime.startsWith("text/html"),f=t&&!p&&(t.mime.startsWith("text/")||t.mime==="application/json"),u=t==null?void 0:t.mime.startsWith("image/"),d=t&&s?`/api/jobs/${s}/results/file?path=${encodeURIComponent(t.path)}`:null,m=d?`${d}&download=true`:null;return e.jsxs(W.div,{variants:R,initial:"initial",animate:"animate",children:[e.jsx("div",{style:{marginBottom:"16px"},children:e.jsx(D,{to:"/jobs",style:{fontSize:"14px",color:"var(--text-dim)"},children:"â† Back to Jobs"})}),e.jsxs("div",{className:"page-header",style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{display:"flex",alignItems:"center",gap:"12px"},children:["Job Details",e.jsx(L,{status:n.status})]}),e.jsx("p",{style:{fontFamily:"monospace",fontSize:"13px"},children:n.job_id})]}),n.status.toLowerCase()==="completed"&&e.jsx("button",{className:"btn-primary",onClick:I,disabled:o.active,children:o.active?"Downloading...":l?"Re-download Results":"Get Results"})]}),(o.active||o.error)&&e.jsx(E,{progress:o.progress,error:o.error,label:"Retrieving Results"}),l&&l.files.length>0&&e.jsxs("div",{className:"card",style:{marginBottom:"24px",padding:0,overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid var(--border)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"4px"},children:"Decrypted Results"}),e.jsxs("div",{style:{fontSize:"13px",color:"var(--text-dim)"},children:[l.files.length," file",l.files.length!==1?"s":""]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px",color:"var(--green)"},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("path",{d:"M9 12l2 2 4-4"})]}),"Decrypted locally"]})]}),e.jsxs("div",{style:{display:"flex",minHeight:"400px"},children:[e.jsx("div",{style:{width:"260px",flexShrink:0,borderRight:"1px solid var(--border)",overflowY:"auto",maxHeight:"600px"},children:l.files.map(i=>e.jsxs("button",{onClick:()=>j(i),style:{display:"flex",alignItems:"center",gap:"10px",width:"100%",padding:"10px 16px",border:"none",borderBottom:"1px solid var(--border)",background:(t==null?void 0:t.path)===i.path?"rgba(99, 102, 241, 0.1)":"transparent",cursor:"pointer",textAlign:"left",color:"var(--text)",transition:"background 0.15s"},onMouseEnter:r=>{(t==null?void 0:t.path)!==i.path&&(r.currentTarget.style.background="rgba(255,255,255,0.03)")},onMouseLeave:r=>{(t==null?void 0:t.path)!==i.path&&(r.currentTarget.style.background="transparent")},children:[e.jsx("span",{style:{fontSize:"10px",fontWeight:700,padding:"2px 6px",borderRadius:"4px",background:i.mime.startsWith("text/html")?"rgba(99, 102, 241, 0.15)":i.mime==="application/json"?"rgba(234, 179, 8, 0.15)":"rgba(255,255,255,0.06)",color:i.mime.startsWith("text/html")?"var(--accent)":i.mime==="application/json"?"var(--yellow)":"var(--text-dim)",flexShrink:0},children:J(i.mime)}),e.jsxs("div",{style:{minWidth:0,flex:1},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:(t==null?void 0:t.path)===i.path?600:400,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.name}),i.path!==i.name&&e.jsx("div",{style:{fontSize:"11px",color:"var(--text-dim)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:i.path}),e.jsx("div",{style:{fontSize:"11px",color:"var(--text-dim)"},children:w(i.size)})]})]},i.path))}),e.jsxs("div",{style:{flex:1,overflow:"hidden",position:"relative"},children:[!t&&e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-dim)",fontSize:"14px"},children:"Select a file to view"}),t&&h&&e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-dim)"},children:"Loading..."}),t&&p&&d&&e.jsx("iframe",{src:d,title:t.name,style:{width:"100%",height:"100%",border:"none",background:"#fff"}}),t&&f&&y!==null&&!h&&e.jsx("pre",{style:{margin:0,padding:"16px",fontSize:"12px",fontFamily:"'Cascadia Code', 'Fira Code', 'JetBrains Mono', monospace",lineHeight:1.6,overflowY:"auto",maxHeight:"600px",whiteSpace:"pre-wrap",wordBreak:"break-word",color:"var(--text)"},children:y}),t&&u&&d&&e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",padding:"16px"},children:e.jsx("img",{src:d,alt:t.name,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})}),t&&!p&&!f&&!u&&!h&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",gap:"12px",color:"var(--text-dim)"},children:[e.jsxs("div",{style:{fontSize:"14px"},children:["Binary file (",w(t.size),")"]}),m&&e.jsxs("a",{href:m,download:t.name,className:"btn-secondary",style:{textDecoration:"none"},children:["Download ",t.name]})]}),t&&m&&(p||f||u)&&e.jsx("div",{style:{position:"absolute",bottom:0,right:0,padding:"8px 12px",background:"var(--surface)",borderTop:"1px solid var(--border)",borderLeft:"1px solid var(--border)",borderRadius:"8px 0 0 0"},children:e.jsx("a",{href:m,download:t.name,style:{fontSize:"12px",color:"var(--accent)",textDecoration:"none"},children:"Download"})})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"8px"},children:"Pipeline"}),e.jsx("div",{style:{fontSize:"16px",fontWeight:600},children:n.plugin_name})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"8px"},children:"Submitted"}),e.jsx("div",{style:{fontSize:"16px"},children:new Date(n.created_at).toLocaleString()})]})]}),n.description&&e.jsxs("div",{className:"card",style:{marginBottom:"24px"},children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"8px"},children:"Description"}),e.jsx("div",{children:n.description})]}),n.timeline&&n.timeline.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"16px"},children:"Timeline"}),e.jsx("div",{className:"timeline",children:n.timeline.map((i,r)=>e.jsxs("div",{className:"timeline-item",children:[e.jsx("div",{className:"phase",children:i.phase}),e.jsx("div",{className:"time",children:new Date(i.timestamp).toLocaleString()})]},r))})]}),e.jsx("div",{style:{marginTop:"24px"},children:e.jsxs("div",{className:"cli-hint",children:["byod status ",n.job_id]})})]})}export{U as JobDetail};
