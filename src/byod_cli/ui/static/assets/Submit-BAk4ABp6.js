import{r as l,j as e,m as p,p as I,u as T,b as F,c as f,d as W,L as J,A as G,e as H,f as K}from"./index-DlxGab-w.js";import{a as C,b as V}from"./Skeleton-CeN7a-3a.js";import{u as O,P as q}from"./ProgressTracker-p4Qyc5Kl.js";function B(t){if(t===0)return"0 B";const a=["B","KB","MB","GB"],c=Math.floor(Math.log(t)/Math.log(1024));return`${(t/Math.pow(1024,c)).toFixed(c===0?0:1)} ${a[c]}`}function Y({onFilesSelect:t,files:a,onClear:c,onRemove:y,accept:v,multiple:d=!0}){const[h,u]=l.useState(!1),r=l.useRef(null),j=l.useCallback(s=>{s.preventDefault(),u(!1);const o=Array.from(s.dataTransfer.files);o.length>0&&t(d?[...a,...o]:[o[0]])},[t,a,d]),m=l.useCallback(s=>{const o=Array.from(s.target.files||[]);o.length>0&&t(d?[...a,...o]:[o[0]]),s.target.value=""},[t,a,d]),b=a.reduce((s,o)=>s+o.size,0);return a.length>0?e.jsxs("div",{className:"file-drop-zone has-files",children:[e.jsx("div",{className:"file-list",children:a.map((s,o)=>e.jsxs("div",{className:"file-item",children:[e.jsxs("div",{className:"file-info",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"var(--accent)",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14,2 14,8 20,8"})]}),e.jsx("span",{className:"file-name",children:s.name}),e.jsx("span",{className:"file-size",children:B(s.size)})]}),e.jsx("button",{className:"file-remove",onClick:()=>y(o),title:"Remove file",children:"×"})]},`${s.name}-${o}`))}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",borderTop:"1px solid var(--border)",fontSize:"12px",color:"var(--text-dim)"},children:[e.jsxs("span",{children:[a.length," file",a.length!==1?"s":""," (",B(b),")"]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[d&&e.jsx("button",{onClick:()=>{var s;return(s=r.current)==null?void 0:s.click()},style:{background:"none",border:"none",color:"var(--accent)",cursor:"pointer",fontSize:"12px",padding:0},children:"+ Add more"}),e.jsx("button",{onClick:c,style:{background:"none",border:"none",color:"var(--red)",cursor:"pointer",fontSize:"12px",padding:0},children:"Clear all"})]})]}),e.jsx("input",{ref:r,type:"file",style:{display:"none"},accept:v,multiple:d,onChange:m})]}):e.jsxs("div",{className:`file-drop-zone ${h?"dragging":""}`,onDragOver:s=>{s.preventDefault(),u(!0)},onDragLeave:()=>u(!1),onDrop:j,onClick:()=>{var s;return(s=r.current)==null?void 0:s.click()},children:[e.jsx("input",{ref:r,type:"file",style:{display:"none"},accept:v,multiple:d,onChange:m}),e.jsxs("div",{className:"drop-zone-content",children:[e.jsxs("svg",{className:"drop-zone-icon",width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17,8 12,3 7,8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"drop-zone-primary",children:["Drop your file",d?"s":""," here or click to browse"]}),e.jsx("div",{className:"drop-zone-secondary",children:d?"Select one or more files":"Supports any file format"})]}),e.jsx("div",{className:"drop-zone-hint",children:"Files will be encrypted locally with AES-256-GCM before upload"})]})]})}function M(){return e.jsxs("div",{className:"security-notice",style:{borderLeft:"3px solid rgba(34, 197, 94, 0.4)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[e.jsxs(p.svg,{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"var(--green)",strokeWidth:"2",variants:I,animate:"animate","aria-hidden":"true",children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("path",{d:"M9 12l2 2 4-4"})]}),e.jsx("strong",{children:"Zero-knowledge encryption"})]}),e.jsx("span",{style:{color:"var(--text-dim)"},children:"Your data is encrypted on this machine using your AWS KMS key before upload. Neither Lablytics nor anyone else can access your plaintext data. Only the cryptographically attested Nitro Enclave can decrypt it for processing."})]})}const D=["Pipeline","Files","Review"];function X(){const[t,a]=l.useState(0),[c,y]=l.useState(1),[v,d]=l.useState([]),[h,u]=l.useState(""),[r,j]=l.useState([]),[m,b]=l.useState(""),[s,o]=l.useState(null),[_,A]=l.useState(!0),E=T(),x=O();l.useEffect(()=>{C("/status").then(o).catch(()=>{}).finally(()=>A(!1))},[]);const N=(s==null?void 0:s.authenticated)&&(s==null?void 0:s.tenant_valid)&&(s==null?void 0:s.kms_key_configured)&&(s==null?void 0:s.role_configured);l.useEffect(()=>{N&&C("/plugins").then(d).catch(()=>{})},[N]);const w=()=>{y(1),a(i=>Math.min(i+1,D.length-1))},z=()=>{y(-1),a(i=>Math.max(i-1,0))},P=i=>{j(n=>n.filter((g,R)=>R!==i))},$=async()=>{if(r.length===0||!h)return;const i=new FormData;for(const n of r)i.append("files",n);i.append("plugin",h),i.append("description",m),x.start("/api/submit",{method:"POST",body:i})},L=r.reduce((i,n)=>i+n.size,0),k=c>0?H:K;if(x.result){const i=x.result;return e.jsxs(p.div,{className:"success-content",variants:F,initial:"initial",animate:"animate",children:[e.jsxs(p.div,{className:"success-icon confetti-container",variants:f,children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"var(--green)",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx(p.path,{d:"M9 12l2 2 4-4",variants:W,initial:"initial",animate:"animate"})]}),[{color:"var(--green)",target:"translate(-30px, -30px) scale(1)"},{color:"var(--accent)",target:"translate(30px, -25px) scale(1)"},{color:"var(--yellow)",target:"translate(-25px, 30px) scale(1)"},{color:"var(--blue)",target:"translate(35px, 20px) scale(1)"},{color:"var(--green)",target:"translate(0px, -35px) scale(1)"},{color:"var(--accent)",target:"translate(-35px, 5px) scale(1)"}].map((n,g)=>e.jsx("span",{className:"confetti-particle",style:{background:n.color,top:"50%",left:"50%",animationDelay:`${g*.08}s`,"--confetti-target":n.target}},g))]}),e.jsx(p.h2,{variants:f,children:"Job Submitted!"}),e.jsx(p.div,{className:"job-id",variants:f,children:e.jsx("code",{style:{background:"var(--surface)",padding:"4px 12px",borderRadius:"6px",border:"1px solid var(--border)"},children:i.job_id})}),e.jsx(p.p,{variants:f,style:{color:"var(--text-dim)",marginBottom:"24px"},children:"Your data was encrypted locally and submitted for processing."}),e.jsxs(p.div,{className:"success-actions",variants:f,children:[e.jsx("button",{className:"btn-primary",onClick:()=>E(`/jobs/${i.job_id}`),children:"View Job"}),e.jsx("button",{className:"btn-secondary",onClick:()=>{x.reset(),a(0),j([]),u(""),b("")},children:"Submit Another"})]})]})}if(x.active||x.error)return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Submitting Job"}),e.jsx("p",{children:"Encrypting and uploading your data..."})]}),e.jsx(M,{}),e.jsx(q,{progress:x.progress,error:x.error,label:"Submission Progress"}),x.error&&e.jsx("div",{style:{marginTop:"16px"},children:e.jsx("button",{className:"btn-secondary",onClick:x.reset,children:"Try Again"})})]});if(_)return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Submit Job"}),e.jsx("p",{children:"Encrypt and submit data for secure processing"})]}),e.jsx(V,{items:4})]});if(!N){const i=[];return s!=null&&s.authenticated||i.push("Not authenticated"),s!=null&&s.authenticated&&!(s!=null&&s.tenant_valid)&&i.push((s==null?void 0:s.tenant_error)||"Tenant is not active"),s!=null&&s.kms_key_configured||i.push((s==null?void 0:s.kms_key_error)||"KMS key not configured"),s!=null&&s.role_configured||i.push((s==null?void 0:s.role_error)||"IAM role not configured"),e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Submit Job"}),e.jsx("p",{children:"Encrypt and submit data for secure processing"})]}),e.jsxs("div",{className:"card",style:{textAlign:"center",padding:"48px 24px"},children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"var(--yellow)",strokeWidth:"2",style:{marginBottom:"16px"},children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),e.jsx("h2",{style:{marginBottom:"8px"},children:"Setup Required"}),e.jsx("p",{style:{color:"var(--text-dim)",marginBottom:"20px",maxWidth:"400px",margin:"0 auto 20px"},children:"All prerequisites must be met before you can submit jobs."}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",marginBottom:"24px"},children:i.map(n=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",fontSize:"14px",color:"var(--red)"},children:[e.jsx("span",{style:{fontSize:"12px"},children:"✗"}),n]},n))}),e.jsx(J,{to:"/setup",className:"btn-primary",style:{textDecoration:"none"},children:"Go to Setup"})]})]})}return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Submit Job"}),e.jsx("p",{children:"Encrypt and submit data for secure processing"})]}),e.jsx("div",{className:"wizard-steps",children:D.map((i,n)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[n>0&&e.jsx("div",{className:"step-connector"}),e.jsxs("div",{className:`wizard-step ${n===t?"active":n<t?"completed":""}`,children:[e.jsx("div",{className:"step-number",children:n<t?"✓":n+1}),e.jsx("span",{className:"step-label",children:i})]})]},i))}),e.jsx("div",{className:"wizard-content",children:e.jsxs(G,{mode:"wait",children:[t===0&&e.jsxs(p.div,{variants:k,initial:"initial",animate:"animate",exit:"exit",className:"step-content",children:[e.jsx("h2",{children:"Select Pipeline"}),e.jsx("p",{children:"Choose the analysis pipeline for your data"}),v.length===0?e.jsx("div",{className:"loading",children:"Loading pipelines..."}):e.jsx("div",{className:"pipeline-grid",children:v.map(i=>{var n;return e.jsxs("div",{className:`pipeline-card ${h===i.name?"selected":""}`,onClick:()=>u(i.name),children:[e.jsx("h3",{children:i.name}),e.jsx("div",{className:"desc",children:i.description}),(n=i.tags)==null?void 0:n.map(g=>e.jsx("span",{className:"tag",children:g},g)),i.input_type&&e.jsxs("div",{style:{marginTop:"8px",fontSize:"12px",color:"var(--text-dim)"},children:["Input: ",i.input_type]})]},i.name)})}),e.jsx("div",{className:"step-actions",children:e.jsx("button",{className:"btn-primary",disabled:!h,onClick:w,children:"Continue"})})]},"step-0"),t===1&&e.jsxs(p.div,{variants:k,initial:"initial",animate:"animate",exit:"exit",className:"step-content",children:[e.jsx("h2",{children:"Upload Files"}),e.jsx("p",{children:"Select the file(s) you want to process"}),e.jsx(Y,{files:r,onFilesSelect:j,onClear:()=>j([]),onRemove:P}),e.jsxs("div",{className:"input-group",style:{marginTop:"20px"},children:[e.jsx("label",{children:"Description (optional)"}),e.jsx("input",{type:"text",className:"description-input",placeholder:"Brief description of this job...",value:m,onChange:i=>b(i.target.value)})]}),e.jsxs("div",{className:"step-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:z,children:"Back"}),e.jsx("button",{className:"btn-primary",disabled:r.length===0,onClick:w,children:"Continue"})]})]},"step-1"),t===2&&e.jsxs(p.div,{variants:k,initial:"initial",animate:"animate",exit:"exit",className:"step-content",children:[e.jsx("h2",{children:"Review & Submit"}),e.jsx("p",{children:"Confirm your submission details"}),e.jsx(M,{}),e.jsxs("div",{className:"review-card",children:[e.jsxs("div",{className:"review-section",children:[e.jsx("h4",{children:"Pipeline"}),e.jsx("p",{style:{fontSize:"15px"},children:h})]}),e.jsxs("div",{className:"review-section",children:[e.jsx("h4",{children:"Files"}),r.length===1?e.jsxs("p",{style:{fontSize:"15px"},children:[r[0].name," (",S(r[0].size),")"]}):e.jsxs("div",{children:[e.jsxs("p",{style:{fontSize:"15px",marginBottom:"8px"},children:[r.length," files (",S(L),")"]}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-dim)"},children:r.map((i,n)=>e.jsxs("div",{style:{fontFamily:"monospace",fontSize:"12px"},children:[i.name," (",S(i.size),")"]},n))})]})]}),m&&e.jsxs("div",{className:"review-section",children:[e.jsx("h4",{children:"Description"}),e.jsx("p",{style:{fontSize:"15px"},children:m})]})]}),e.jsxs("div",{className:"step-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:z,children:"Back"}),e.jsx("button",{className:"btn-primary",onClick:$,children:"Encrypt & Submit"})]})]},"step-2")]})})]})}function S(t){if(t===0)return"0 B";const a=["B","KB","MB","GB"],c=Math.floor(Math.log(t)/Math.log(1024));return`${(t/Math.pow(1024,c)).toFixed(c===0?0:1)} ${a[c]}`}export{X as Submit};
