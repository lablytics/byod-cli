import{r as j,j as e,m as n,L as p,s as f,a as o}from"./index-B8SBTCI8.js";import{u,S as b}from"./Skeleton-Cg_dwXAZ.js";import{S as N}from"./StatusBadge-CPNlcQHy.js";function g({value:r,color:t}){const[l,y]=j.useState(0),s=j.useRef(0);return j.useEffect(()=>{const a=s.current,d=r;if(a===d)return;const c=400,m=performance.now();function x(i){const v=i-m,h=Math.min(v/c,1),k=1-Math.pow(1-h,3);y(Math.round(a+(d-a)*k)),h<1?requestAnimationFrame(x):s.current=d}requestAnimationFrame(x)},[r]),e.jsx("span",{style:t?{color:t}:void 0,children:l})}function C(){const{data:r,loading:t}=u("/status"),{data:l,loading:y,error:s}=u("/jobs?limit=5"),[a,d]=j.useState(null);j.useEffect(()=>{fetch("/api/status/aws").then(i=>i.json()).then(i=>d(i.configured)).catch(()=>d(!1))},[]);const c=(l||[]).reduce((i,v)=>{i.total++;const h=v.status.toLowerCase();return h==="completed"?i.completed++:h==="processing"?i.processing++:h==="failed"&&i.failed++,i},{total:0,completed:0,processing:0,failed:0}),m=(r==null?void 0:r.tenant_valid)??!1,x=m&&a&&(r==null?void 0:r.kms_key_configured);return e.jsxs("div",{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h1",{children:"Welcome to BYOD"}),e.jsx("p",{children:"Secure biotech data processing with zero-knowledge encryption"})]}),!t&&(r==null?void 0:r.tenant_error)&&e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{background:"rgba(239, 68, 68, 0.08)",border:"1px solid rgba(239, 68, 68, 0.25)",borderRadius:"12px",padding:"20px 24px",marginBottom:"24px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"var(--red)",strokeWidth:"2",style:{flexShrink:0,marginTop:"2px"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:"4px",color:"var(--red)"},children:"Tenant issue detected"}),e.jsx("div",{style:{color:"var(--text-dim)",fontSize:"14px",marginBottom:"12px"},children:r.tenant_error}),e.jsxs("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[r.tenant_error.includes("API key")&&e.jsx("div",{className:"cli-hint",style:{display:"inline-block"},children:"byod auth login"}),r.tenant_error.includes("tenant")&&e.jsx("a",{href:r.api_url,target:"_blank",rel:"noopener noreferrer",className:"btn-small",children:"Open Dashboard"}),e.jsx(p,{to:"/setup",className:"btn-small",children:"Re-run Setup"})]})]})]})}),!t&&!(r!=null&&r.tenant_error)&&(!(r!=null&&r.authenticated)||a===!1)&&e.jsxs(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{background:"rgba(234, 179, 8, 0.08)",border:"1px solid rgba(234, 179, 8, 0.2)",borderRadius:"12px",padding:"20px 24px",marginBottom:"24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:"4px"},children:"Setup required"}),e.jsx("div",{style:{color:"var(--text-dim)",fontSize:"14px"},children:r!=null&&r.authenticated?"AWS credentials not detected. Configure your ~/.aws/credentials.":"Run 'byod auth login' in your terminal to authenticate, then refresh."})]}),e.jsx(p,{to:"/setup",className:"btn-primary",style:{flexShrink:0},children:"Run Setup"})]}),!t&&m&&(!(r!=null&&r.kms_key_configured)||!(r!=null&&r.role_configured))&&e.jsx(n.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},style:{background:r!=null&&r.kms_key_error||r!=null&&r.role_error?"rgba(239, 68, 68, 0.08)":"rgba(234, 179, 8, 0.08)",border:`1px solid ${r!=null&&r.kms_key_error||r!=null&&r.role_error?"rgba(239, 68, 68, 0.25)":"rgba(234, 179, 8, 0.2)"}`,borderRadius:"12px",padding:"20px 24px",marginBottom:"24px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600,marginBottom:"4px"},children:r!=null&&r.kms_key_error||r!=null&&r.role_error?"AWS resources missing":"KMS setup incomplete"}),e.jsx("div",{style:{color:"var(--text-dim)",fontSize:"14px"},children:r!=null&&r.kms_key_error&&(r!=null&&r.role_error)?"KMS key and IAM role no longer exist in AWS. Re-run setup to recreate them.":r!=null&&r.kms_key_error?r.kms_key_error:r!=null&&r.role_error?r.role_error:!(r!=null&&r.kms_key_configured)&&!(r!=null&&r.role_configured)?"KMS key and IAM role are not configured. Run setup to create them.":r!=null&&r.kms_key_configured?"IAM role is not configured.":"KMS key is not configured."})]}),e.jsx(p,{to:"/setup",className:"btn-primary",style:{flexShrink:0},children:r!=null&&r.kms_key_error||r!=null&&r.role_error?"Re-run Setup":"Run Setup"})]})}),e.jsxs(n.div,{className:"stats-row",variants:f,initial:"initial",animate:"animate",children:[e.jsxs(n.div,{className:"stat-card",variants:o,children:[e.jsx("div",{className:"label",children:"Authentication"}),e.jsx("div",{className:"value",style:{fontSize:"20px"},children:t?e.jsx("span",{className:"loading-spinner"}):r!=null&&r.authenticated?e.jsxs("span",{style:{color:"var(--green)",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}),"Connected"]}):e.jsxs("span",{style:{color:"var(--red)",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]}),"Not authenticated"]})}),(r==null?void 0:r.profile)&&e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-dim)",marginTop:"4px"},children:["Profile: ",r.profile]})]}),e.jsxs(n.div,{className:"stat-card",variants:o,children:[e.jsx("div",{className:"label",children:"Tenant"}),e.jsx("div",{className:"value",style:{fontSize:"20px"},children:t?e.jsx("span",{className:"loading-spinner"}):m?e.jsxs("span",{style:{color:"var(--green)",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}),"Active"]}):r!=null&&r.authenticated?e.jsxs("span",{style:{color:"var(--red)",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M15 9l-6 6M9 9l6 6"})]}),"Invalid"]}):e.jsx("span",{style:{color:"var(--text-dim)"},children:"—"})}),(r==null?void 0:r.tenant_id)&&e.jsxs("div",{style:{fontSize:"12px",color:"var(--text-dim)",marginTop:"4px",fontFamily:"monospace"},children:[r.tenant_id.slice(0,12),"..."]})]}),e.jsxs(n.div,{className:"stat-card",variants:o,children:[e.jsx("div",{className:"label",children:"AWS Credentials"}),e.jsx("div",{className:"value",style:{fontSize:"20px"},children:a===null?e.jsx("span",{className:"loading-spinner"}):a?e.jsxs("span",{style:{color:"var(--green)",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",children:e.jsx("path",{d:"M20 6L9 17l-5-5"})}),"Configured"]}):e.jsxs("span",{style:{color:"var(--yellow)",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 8v4M12 16h.01"})]}),"Not found"]})})]}),e.jsxs(n.div,{className:"stat-card",variants:o,children:[e.jsx("div",{className:"label",children:"CLI Version"}),e.jsx("div",{className:"value",style:{fontSize:"20px"},children:(r==null?void 0:r.version)||e.jsx("span",{className:"loading-spinner"})}),(r==null?void 0:r.api_url)&&e.jsx("div",{style:{fontSize:"12px",color:"var(--text-dim)",marginTop:"4px"},children:r.api_url})]})]}),e.jsxs("div",{style:{display:"flex",gap:"16px",marginBottom:"32px"},children:[e.jsx(p,{to:"/submit",className:"btn-primary",style:{textDecoration:"none",opacity:x?1:.5,pointerEvents:x?"auto":"none"},children:"Submit New Job"}),e.jsx(p,{to:"/jobs",className:"btn-secondary",style:{textDecoration:"none"},children:"View All Jobs"})]}),!y&&!s&&l&&l.length>0&&e.jsxs(n.div,{className:"stats-row",variants:f,initial:"initial",animate:"animate",style:{marginBottom:"24px"},children:[e.jsxs(n.div,{className:"stat-card stat-accent",variants:o,children:[e.jsx("div",{className:"label",children:"Total Jobs"}),e.jsx("div",{className:"value",children:e.jsx(g,{value:c.total})})]}),e.jsxs(n.div,{className:"stat-card stat-green",variants:o,children:[e.jsx("div",{className:"label",children:"Completed"}),e.jsx("div",{className:"value",children:e.jsx(g,{value:c.completed,color:"var(--green)"})})]}),e.jsxs(n.div,{className:"stat-card stat-yellow",variants:o,children:[e.jsx("div",{className:"label",children:"Processing"}),e.jsx("div",{className:"value",children:e.jsx(g,{value:c.processing,color:"var(--yellow)"})})]}),e.jsxs(n.div,{className:"stat-card stat-red",variants:o,children:[e.jsx("div",{className:"label",children:"Failed"}),e.jsx("div",{className:"value",children:e.jsx(g,{value:c.failed,color:"var(--red)"})})]})]}),e.jsxs("div",{className:"card",style:{padding:0},children:[e.jsx("div",{style:{padding:"20px 24px",borderBottom:"1px solid var(--border)"},children:e.jsx("h2",{style:{fontSize:"18px",fontWeight:600},children:"Recent Jobs"})}),y?e.jsx(b,{rows:3,cols:4}):s?e.jsxs("div",{style:{padding:"32px 24px",textAlign:"center",color:"var(--text-dim)"},children:[e.jsx("p",{style:{marginBottom:"8px"},children:"Could not load jobs"}),e.jsx("p",{style:{fontSize:"13px"},children:s.includes("401")||s.includes("authenticated")?"Authentication required — run 'byod auth login' first.":s.includes("502")||s.includes("connect")?"API server is unreachable. Check your connection.":s})]}):!l||l.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsxs("svg",{className:"empty-state-icon",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeDasharray:"3 3",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),e.jsx("path",{d:"M3 9h18",strokeDasharray:"none"}),e.jsx("path",{d:"M9 21V9",strokeDasharray:"none"})]}),e.jsx("div",{className:"empty-state-title",children:"No jobs yet"}),e.jsx("div",{className:"empty-state-description",children:"Submit your first data processing job to get started"}),x&&e.jsx(p,{to:"/submit",className:"btn-primary",style:{textDecoration:"none"},children:"Submit your first job"})]}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Job ID"}),e.jsx("th",{children:"Pipeline"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Submitted"})]})}),e.jsx("tbody",{children:l.map(i=>e.jsxs("tr",{className:`row-${i.status.toLowerCase()}`,onClick:()=>window.location.href=`/jobs/${i.job_id}`,children:[e.jsx("td",{style:{fontFamily:"monospace",fontSize:"12px",whiteSpace:"nowrap"},children:i.job_id}),e.jsx("td",{children:i.plugin_name}),e.jsx("td",{children:e.jsx(N,{status:i.status})}),e.jsx("td",{style:{color:"var(--text-dim)"},children:new Date(i.created_at).toLocaleString()})]},i.job_id))})]})})]})]})}export{C as Home};
